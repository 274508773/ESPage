/*
	Leaflet.measure, a plugin that adds measure  distance to Leaflet powered maps.
	(c) 2016-2018, liulin, ExSun


	http://leafletjs.com
*/
!function(t,e,i){L.measureVersion="0.0.1-dev",L.measure={TipMarker:{setText:{beginText:"begin  ",until:" Km  "},createIcon:{closeText:"X"},addTotalPenal:{total:" total ",until:" Km "},setSubTotalDistTag:{total:" subtotal ",until:" Km "}},Dist:{_getTooltipText:{start:"Click to start measure  dist.",cont:"Click to continue measure dist.",end:"Click last point to finish measure."}},error:"<strong>Error:</strong> shape edges cannot cross!"},L.Map.mergeOptions({touchExtend:!0}),L.Map.TouchExtend=L.Handler.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane},addHooks:function(){L.DomEvent.on(this._container,"touchstart",this._onTouchStart,this),L.DomEvent.on(this._container,"touchend",this._onTouchEnd,this),L.DomEvent.on(this._container,"touchmove",this._onTouchMove,this),this._detectIE()?(L.DomEvent.on(this._container,"MSPointerDown",this._onTouchStart,this),L.DomEvent.on(this._container,"MSPointerUp",this._onTouchEnd,this),L.DomEvent.on(this._container,"MSPointerMove",this._onTouchMove,this),L.DomEvent.on(this._container,"MSPointerCancel",this._onTouchCancel,this)):(L.DomEvent.on(this._container,"touchcancel",this._onTouchCancel,this),L.DomEvent.on(this._container,"touchleave",this._onTouchLeave,this))},removeHooks:function(){L.DomEvent.off(this._container,"touchstart",this._onTouchStart),L.DomEvent.off(this._container,"touchend",this._onTouchEnd),L.DomEvent.off(this._container,"touchmove",this._onTouchMove),this._detectIE()?(L.DomEvent.off(this._container,"MSPointerDowm",this._onTouchStart),L.DomEvent.off(this._container,"MSPointerUp",this._onTouchEnd),L.DomEvent.off(this._container,"MSPointerMove",this._onTouchMove),L.DomEvent.off(this._container,"MSPointerCancel",this._onTouchCancel)):(L.DomEvent.off(this._container,"touchcancel",this._onTouchCancel),L.DomEvent.off(this._container,"touchleave",this._onTouchLeave))},_touchEvent:function(t,e){var i={};if("undefined"!=typeof t.touches){if(!t.touches.length)return;i=t.touches[0]}else{if("touch"!==t.pointerType)return;if(i=t,!this._filterClick(t))return}var o=this._map.mouseEventToContainerPoint(i),s=this._map.mouseEventToLayerPoint(i),n=this._map.layerPointToLatLng(s);this._map.fire(e,{latlng:n,layerPoint:s,containerPoint:o,pageX:i.pageX,pageY:i.pageY,originalEvent:t})},_filterClick:function(t){var e=t.timeStamp||t.originalEvent.timeStamp,i=L.DomEvent._lastClick&&e-L.DomEvent._lastClick;return i&&i>100&&500>i||t.target._simulatedClick&&!t._simulated?(L.DomEvent.stop(t),!1):(L.DomEvent._lastClick=e,!0)},_onTouchStart:function(t){if(this._map._loaded){var e="touchstart";this._touchEvent(t,e)}},_onTouchEnd:function(t){if(this._map._loaded){var e="touchend";this._touchEvent(t,e)}},_onTouchCancel:function(t){if(this._map._loaded){var e="touchcancel";this._detectIE()&&(e="pointercancel"),this._touchEvent(t,e)}},_onTouchLeave:function(t){if(this._map._loaded){var e="touchleave";this._touchEvent(t,e)}},_onTouchMove:function(t){if(this._map._loaded){var e="touchmove";this._touchEvent(t,e)}},_detectIE:function(){var e=t.navigator.userAgent,i=e.indexOf("MSIE ");if(i>0)return parseInt(e.substring(i+5,e.indexOf(".",i)),10);var o=e.indexOf("Trident/");if(o>0){var s=e.indexOf("rv:");return parseInt(e.substring(s+3,e.indexOf(".",s)),10)}var n=e.indexOf("Edge/");return n>0?parseInt(e.substring(n+5,e.indexOf(".",n)),10):!1}}),L.Map.addInitHook("addHandler","touchExtend",L.Map.TouchExtend),L.Marker.Touch=L.Marker.extend({_initInteraction:function(){return this.addInteractiveTarget?L.Marker.prototype._initInteraction.apply(this):this._initInteractionLegacy()},_initInteractionLegacy:function(){if(this.options.clickable){var t=this._icon,e=["dblclick","mousedown","mouseover","mouseout","contextmenu","touchstart","touchend","touchmove"];this._detectIE?e.concat(["MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"]):e.concat(["touchcancel"]),L.DomUtil.addClass(t,"leaflet-clickable"),L.DomEvent.on(t,"click",this._onMouseClick,this),L.DomEvent.on(t,"keypress",this._onKeyPress,this);for(var i=0;i<e.length;i++)L.DomEvent.on(t,e[i],this._fireMouseEvent,this);L.Handler.MarkerDrag&&(this.dragging=new L.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_detectIE:function(){var e=t.navigator.userAgent,i=e.indexOf("MSIE ");if(i>0)return parseInt(e.substring(i+5,e.indexOf(".",i)),10);var o=e.indexOf("Trident/");if(o>0){var s=e.indexOf("rv:");return parseInt(e.substring(s+3,e.indexOf(".",s)),10)}var n=e.indexOf("Edge/");return n>0?parseInt(e.substring(n+5,e.indexOf(".",n)),10):!1}}),L.LatLngUtil={cloneLatLngs:function(t){for(var e=[],i=0,o=t.length;o>i;i++)Array.isArray(t[i])?e.push(L.LatLngUtil.cloneLatLngs(t[i])):e.push(this.cloneLatLng(t[i]));return e},cloneLatLng:function(t){return L.latLng(t.lat,t.lng)}},L.GeometryUtil=L.extend(L.GeometryUtil||{},{geodesicArea:function(t){var e,i,o=t.length,s=0,n=Math.PI/180;if(o>2){for(var r=0;o>r;r++)e=t[r],i=t[(r+1)%o],s+=(i.lng-e.lng)*n*(2+Math.sin(e.lat*n)+Math.sin(i.lat*n));s=6378137*s*6378137/2}return Math.abs(s)},readableArea:function(t,e){var i;return e?i=t>=1e4?(1e-4*t).toFixed(2)+" ha":t.toFixed(2)+" m&sup2;":(t/=.836127,i=t>=3097600?(t/3097600).toFixed(2)+" mi&sup2;":t>=4840?(t/4840).toFixed(2)+" acres":Math.ceil(t)+" yd&sup2;"),i},readableDistance:function(t,e,i){var o;if(e)o=t>1e3?(t/1e3).toFixed(2)+" km":Math.ceil(t)+" m";else if(t*=1.09361,t>1760)o=(t/1760).toFixed(2)+" miles";else{var s=" yd";i&&(t=3*t,s=" ft"),o=Math.ceil(t)+s}return o}}),L.Util.extend(L.LineUtil,{segmentsIntersect:function(t,e,i,o){return this._checkCounterclockwise(t,i,o)!==this._checkCounterclockwise(e,i,o)&&this._checkCounterclockwise(t,e,i)!==this._checkCounterclockwise(t,e,o)},_checkCounterclockwise:function(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}}),L.Polyline.include({intersects:function(){var t,e,i,o=this._getProjectedPoints(),s=o?o.length:0;if(this._tooFewPointsForIntersection())return!1;for(t=s-1;t>=3;t--)if(e=o[t-1],i=o[t],this._lineSegmentsIntersectsRange(e,i,t-2))return!0;return!1},newLatLngIntersects:function(t,e){return this._map?this.newPointIntersects(this._map.latLngToLayerPoint(t),e):!1},newPointIntersects:function(t,e){var i=this._getProjectedPoints(),o=i?i.length:0,s=i?i[o-1]:null,n=o-2;return this._tooFewPointsForIntersection(1)?!1:this._lineSegmentsIntersectsRange(s,t,n,e?1:0)},_tooFewPointsForIntersection:function(t){var e=this._getProjectedPoints(),i=e?e.length:0;return i+=t||0,!e||3>=i},_lineSegmentsIntersectsRange:function(t,e,i,o){var s,n,r=this._getProjectedPoints();o=o||0;for(var a=i;a>o;a--)if(s=r[a-1],n=r[a],L.LineUtil.segmentsIntersect(t,e,s,n))return!0;return!1},_getProjectedPoints:function(){if(!this._defaultShape)return this._originalPoints;for(var t=[],e=this._defaultShape(),i=0;i<e.length;i++)t.push(this._map.latLngToLayerPoint(e[i]));return t}}),L.Polygon.include({intersects:function(){var t,e,i,o,s,n=this._getProjectedPoints();return this._tooFewPointsForIntersection()?!1:(t=L.Polyline.prototype.intersects.call(this))?!0:(e=n.length,i=n[0],o=n[e-1],s=e-2,this._lineSegmentsIntersectsRange(o,i,s,1))}}),L.Measure=L.Measure||{},L.Measure.Tooltip=L.Class.extend({initialize:function(t){this._map=t,this._popupPane=t._panes.popupPane,this._container=t.options.drawControlTooltips?L.DomUtil.create("div","leaflet-draw-tooltip",this._popupPane):null,this._singleLineLabel=!1,this._map.on("mouseout",this._onMouseOut,this)},dispose:function(){this._map.off("mouseout",this._onMouseOut,this),this._container&&(this._popupPane.removeChild(this._container),this._container=null)},updateContent:function(t){return this._container?(t.subtext=t.subtext||"",0!==t.subtext.length||this._singleLineLabel?t.subtext.length>0&&this._singleLineLabel&&(L.DomUtil.removeClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!1):(L.DomUtil.addClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!0),this._container.innerHTML=(t.subtext.length>0?'<span class="leaflet-draw-tooltip-subtext">'+t.subtext+"</span><br />":"")+"<span>"+t.text+"</span>",this):this},updatePosition:function(t){var e=this._map.latLngToLayerPoint(t),i=this._container;return this._container&&(i.style.visibility="inherit",L.DomUtil.setPosition(i,e)),this},showAsError:function(){return this._container&&L.DomUtil.addClass(this._container,"leaflet-error-draw-tooltip"),this},removeError:function(){return this._container&&L.DomUtil.removeClass(this._container,"leaflet-error-draw-tooltip"),this},_onMouseOut:function(){this._container&&(this._container.style.visibility="hidden")}}),L.Measure=L.Measure||{},L.Measure.DistMgr=L.Handler.extend({options:{},initialize:function(t,e){this._map=t,L.setOptions(this,e),this.aoDistHandker=[]},addHooks:function(){var t=L.Measure.dist(this._map,this,this.options);this.oLastDist=t,this.aoDistHandker.push(t),t.createDist()},removeHooks:function(){this.oLastDist.removeDist()}}),L.Measure.distMgr=function(t,e){return new L.Measure.DistMgr(t,e)},L.Measure.Dist=L.Class.extend({includes:L.Mixin.Events,statics:{TYPE:"DIST"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#b00b00",timeout:2500},touchIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"}),guidelineDistance:20,maxGuideLineLength:4e3,shapeOptions:{stroke:!0,color:"#f06eaa",weight:2,opacity:1,fill:!1,clickable:!0},metric:!0,feet:!0,showLength:!0,bIsTotalDist:!0},initialize:function(t,e,i){L.Browser.touch&&(this.options.icon=this.options.touchIcon),this._oParent=e,this.options.drawError.message=L.measure.error,i&&i.drawError&&(i.drawError=L.Util.extend({},this.options.drawError,i.drawError)),this.type=L.Measure.Dist.TYPE,this._map=t,this._container=t._container,this._overlayPane=t._panes.overlayPane,this._popupPane=t._panes.popupPane,i&&i.shapeOptions&&(i.shapeOptions=L.Util.extend({},this.options.shapeOptions,i.shapeOptions)),L.setOptions(this,i)},createDist:function(){this._map&&(L.DomUtil.disableTextSelection(),this._container.focus(),this._tooltip=new L.Measure.Tooltip(this._map),L.DomEvent.on(this._container,"keyup",this._cancelDrawing,this),this._oMarkerMgr=new L.Measure.MarkerMgr(this._map,this),this._oTipMarkerMgr=new L.Measure.TipMarkerMgr(this._map,this),this._poly=new L.Polyline([],this.options.shapeOptions),this._tooltip.updateContent(this._getTooltipText()),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),L.Browser.touch||this._map.on("mouseup",this._onMouseUp,this),this._mouseMarker.on("mousedown",this._onMouseDown,this).on("mouseout",this._onMouseOut,this).on("mouseup",this._onMouseUp,this).on("mousemove",this._onMouseMove,this).addTo(this._map),this._map.on("mouseup",this._onMouseUp,this).on("mousemove",this._onMouseMove,this).on("zoomlevelschange",this._onZoomEnd,this).on("click",this._onTouch,this).on("zoomend",this._onZoomEnd,this))},removeDist:function(){L.DomUtil.enableTextSelection(),this._tooltip.dispose(),this._tooltip=null,L.DomEvent.off(this._container,"keyup",this._cancelDrawing,this),this._clearHideErrorTimeout(),this._oMarkerMgr.cleanUpShape(),this._mouseMarker.off("mousedown",this._onMouseDown,this).off("mouseout",this._onMouseOut,this).off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._clearGuides(),this._map.off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this).off("zoomlevelschange",this._onZoomEnd,this).off("zoomend",this._onZoomEnd,this).off("click",this._onTouch,this)},deleteLastVertex:function(){if(!(this._markers.length<=1)){var t=this._markers.pop(),e=this._poly,i=this._poly.spliceLatLngs(e.getLatLngs().length-1,1)[0];this._markerGroup.removeLayer(t),e.getLatLngs().length<2&&this._map.removeLayer(e),this._vertexChanged(i,!1)}},addVertex:function(t){var e=this._oMarkerMgr.getLen();if(e>0&&!this.options.allowIntersection&&this._poly.newLatLngIntersects(t))return void this._showErrorTooltip();this._errorShown&&this._hideErrorTooltip();var i=this._oMarkerMgr.createMarker(t);this._oTipMarkerMgr.createMarker(t,i,{className:"rule_text_box",iconAnchor:[-10,20]}),this._poly.addLatLng(t),2===this._poly.getLatLngs().length&&this._map.addLayer(this._poly),this._vertexChanged(t,!0)},completeShape:function(){this._markers.length<=1||(this.removeDist(),this.options.repeatMode&&this._oParent.enable())},deleteHandler:function(t){if(this._oMarkerMgr&&!(this._oMarkerMgr.getLen()<=0)){this._oMarkerMgr.removeMarker(t);var e=this._oMarkerMgr.getPointMarkers();this._poly.setLatLngs(e)}},clearData:function(){!this._oMarkerMgr||this._oMarkerMgr.getLen()<=0||(this._oMarkerMgr.clearData(),this._poly.setLatLngs([]))},_finishShape:function(){var t=this._poly.newLatLngIntersects(this._poly.getLatLngs()[this._poly.getLatLngs().length-1]);return!this.options.allowIntersection&&t||!this._shapeIsValid()?void this._showErrorTooltip():(this._oTipMarkerMgr.addCloseBtn(),this.options.bIsTotalDist&&this._oTipMarkerMgr.addTotalDist(),this._oParent.disable(),void(this.options.repeatMode&&this.enable()))},_shapeIsValid:function(){return!0},_onZoomEnd:function(){null!==this._markers&&this._updateGuide()},_onMouseMove:function(t){var e=this._map.mouseEventToLayerPoint(t.originalEvent),i=this._map.layerPointToLatLng(e);this._currentLatLng=i,this._updateTooltip(i),this._updateGuide(e),this._mouseMarker.setLatLng(i),L.DomEvent.preventDefault(t.originalEvent)},_vertexChanged:function(){this._map.fire("draw:drawvertex",{layers:this._markerGroup}),this._oMarkerMgr.updateFinishHandler(),this._clearGuides(),this._updateTooltip()},_onMouseDown:function(t){var e=t.originalEvent;this._mouseDownOrigin=L.point(e.clientX,e.clientY)},_onMouseUp:function(e){if(this._mouseDownOrigin){var i=L.point(e.originalEvent.clientX,e.originalEvent.clientY).distanceTo(this._mouseDownOrigin);Math.abs(i)<9*(t.devicePixelRatio||1)&&this.addVertex(e.latlng)}this._mouseDownOrigin=null},_onTouch:function(t){L.Browser.touch&&(this._onMouseDown(t),this._onMouseUp(t))},_onMouseOut:function(){this._tooltip&&this._tooltip._onMouseOut.call(this._tooltip)},_createMarker:function(t){var e=new L.Marker(t,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset});return this._markerGroup.addLayer(e),e},_updateGuide:function(t){var e=this._oMarkerMgr?this._oMarkerMgr.getLen():0;e>0&&(t=t||this._map.latLngToLayerPoint(this._currentLatLng),this._clearGuides(),this._drawGuide(this._map.latLngToLayerPoint(this._oMarkerMgr.getLastGeoPos()),t))},_updateTooltip:function(t){var e=this._getTooltipText();t&&this._tooltip.updatePosition(t),this._errorShown||this._tooltip.updateContent(e)},_drawGuide:function(t,e){var i,o,s,n=Math.floor(Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))),r=this.options.guidelineDistance,a=this.options.maxGuideLineLength,h=n>a?n-a:r;for(this._guidesContainer||(this._guidesContainer=L.DomUtil.create("div","leaflet-draw-guides",this._overlayPane));n>h;h+=this.options.guidelineDistance)i=h/n,o={x:Math.floor(t.x*(1-i)+i*e.x),y:Math.floor(t.y*(1-i)+i*e.y)},s=L.DomUtil.create("div","leaflet-draw-guide-dash",this._guidesContainer),s.style.backgroundColor=this._errorShown?this.options.drawError.color:this.options.shapeOptions.color,L.DomUtil.setPosition(s,o)},_updateGuideColor:function(t){if(this._guidesContainer)for(var e=0,i=this._guidesContainer.childNodes.length;i>e;e++)this._guidesContainer.childNodes[e].style.backgroundColor=t},_clearGuides:function(){if(this._guidesContainer)for(;this._guidesContainer.firstChild;)this._guidesContainer.removeChild(this._guidesContainer.firstChild)},_getTooltipText:function(){var t,e,i=this.options.showLength,o=this._oMarkerMgr.getLen();return 0===o?t={text:L.measure.Dist._getTooltipText.start}:(e=i?this._getMeasurementString():"",t=1===o?{text:L.measure.Dist._getTooltipText.cont,subtext:e}:{text:L.measure.Dist._getTooltipText.end,subtext:e}),t},_getMeasurementString:function(){var t,e=this._currentLatLng,i=this._oMarkerMgr.getLastGeoPos();return t=this._oTipMarkerMgr.getTotalDist()+e.distanceTo(i),L.GeometryUtil.readableDistance(t,this.options.metric,this.options.feet)},_showErrorTooltip:function(){this._errorShown=!0,this._tooltip.showAsError().updateContent({text:this.options.drawError.message}),this._updateGuideColor(this.options.drawError.color),this._poly.setStyle({color:this.options.drawError.color}),this._clearHideErrorTimeout(),this._hideErrorTimeout=setTimeout(L.Util.bind(this._hideErrorTooltip,this),this.options.drawError.timeout)},_hideErrorTooltip:function(){this._errorShown=!1,this._clearHideErrorTimeout(),this._tooltip.removeError().updateContent(this._getTooltipText()),this._updateGuideColor(this.options.shapeOptions.color),this._poly.setStyle({color:this.options.shapeOptions.color})},_clearHideErrorTimeout:function(){this._hideErrorTimeout&&(clearTimeout(this._hideErrorTimeout),this._hideErrorTimeout=null)},_cancelDrawing:function(t){this._map.fire("draw:canceled",{layerType:this.type}),27===t.keyCode&&this._oParent.disable()}}),L.Measure.dist=function(t,e){return new L.Measure.Dist(t,e)},L.Measure.MarkerMgr=L.Class.extend({statics:{TYPE:"DIST"},options:{icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),zIndexOffset:2e3},initialize:function(t,e,i){this._map=t,this._oParent=e,L.setOptions(this,i),this._dTotalDist=0,this._markers=[],this._layerGroup=L.featureGroup(),this._map.addLayer(this._layerGroup)},createMarker:function(t,e){var i=L.extend({},e,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset}),o=new L.Marker(t,i);return this._layerGroup.addLayer(o),this._markers.push(o),o},getLen:function(){return this._markers?this._markers.length:0},getLastMarker:function(){return!this._markers||this._markers.length<=0?null:this._markers[this._markers.length-1]},getLastGeoPos:function(){var t=this.getLastMarker();return t.getLatLng()},getPointMarkers:function(){var t=[];if(!this._markers||this._markers.length<=0)return t;for(var e=0;e<this._markers.length;e++)t.push(this._markers[e].getLatLng());return t},updateFinishHandler:function(){var t=this._markers.length;1===t&&this._markers[0].on("click",this._finishShape,this),t>2&&(this._markers[t-1].on("dblclick",this._finishShape,this),t>3&&this._markers[t-2].off("dblclick",this._finishShape,this))},cleanUpShape:function(){this._markers<=1||this.getLastMarker().off("click",this._finishShape,this)},_finishShape:function(){this._oParent._finishShape()},removeMarker:function(t){for(var e=this._markers.length-1;e>=0;e--)if(this._markers[e]===t){this._markers.splice(e,1);break}this._layerGroup.removeLayer(t)},updateDist:function(){for(var t=0;t<this._markers;t++)if(0!==t){var e=this._tipMarkers[t].getLatLng().distanceTo(this._tipMarkers[t-1]);this._tipMarkers[t].setDist(e)}else this._tipMarkers[t].setDist(0)},clearData:function(){this._markers.splice(0,this._markers.length),this._layerGroup.clearLayers()},remove:function(){this._map.removeLayer(this._layerGroup),delete this._layerGroup,delete this._markers}}),L.Measure.TipMarkerMgr=L.Class.extend({statics:{TYPE:"DIST"},initialize:function(t,e,i){this._map=t,L.setOptions(this,i),this._markers=[],this._layerGroup=L.featureGroup(),this._map.addLayer(this._layerGroup),this._oParent=e},options:{},createMarker:function(t,e,i){var o=L.Measure.tipMarker(t,this,i);o.addTo(this._layerGroup),this._markers.push(o);var s=this.getSecLastMarker(),n=this.calDist(o,s);return o.setDist(n),this._markers.length>1&&(n=this.getTotalDist(),o.setSubTotalDist(n)),e&&(o.oRelaMarker=e),o},calDist:function(t,e){if(!e)return 0;var i=t.getLatLng(),o=e.getLatLng();return i.distanceTo(o)},getTotalDist:function(){if(this._markers.length<=0)return 0;for(var t=0,e=0;e<this._markers.length;e++)t+=this._markers[e].dDist;return t},getLastMarker:function(){return!this._markers||this._markers.length<=0?null:this._markers[this.getLen()-1]},getLastGeoPos:function(){var t=this.getLastMarker();return t.getLatLng()},getSecLastMarker:function(){return!this._markers||this._markers.length<=1?null:this._markers[this.getLen()-2]},getLen:function(){return this._markers?this._markers.length:0},addCloseBtn:function(){var t=this.getLastMarker();t&&t.addAllClose()},addTotalDist:function(){var t=this.getLastMarker();if(t){var e=this.getTotalDist();t.addTotalPenal(e)}},setTipTotalDist:function(){var t=this.getLastMarker();if(t){var e=this.getTotalDist();t.setTotalDist(e)}},setSubDist:function(){if(this._markers&&!(this._markers.length<=0)){this._markers[0].setDist(0),this._markers[0].deleteSubTotalTag();for(var t=1;t<this._markers.length;t++){var e=this.calDist(this._markers[t],this._markers[t-1]);this._markers[t].setDist(e)}}},setTipSubTotalDist:function(){if(this._markers&&!(this._markers.length<=0))for(var t=0,e=1;e<this._markers.length;e++)t=this._markers[e].dDist+t,this._markers[e].setSubTotalDist(t)},update:function(){this.setSubDist(),this.setTipSubTotalDist(),this._oParent.options.bIsTotalDist?this.addTotalDist():this.setTipTotalDist(),this.addCloseBtn()},removeTipMarker:function(t){if(2===this._markers.length)return this.clearData(),void this._oParent.clearData();for(var e=this._markers.length-1;e>=0;e--)if(this._markers[e]===t){this._markers.splice(e,1);break}this.update(),t.oRelaMarker&&this._oParent.deleteHandler(t.oRelaMarker),this._layerGroup.removeLayer(t)},clearData:function(){this._markers.splice(0,this._markers.length),this._layerGroup.clearLayers()},deleteDist:function(){this.clearData(),this._oParent.clearData()},remove:function(){this._map.removeLayer(this._layerGroup),delete this._layerGroup,delete this._markers}}),L.Measure.TipMarker=L.Marker.extend({options:{oShowConfig:{bIsSubDist:!0,bIsSubTotalDist:!0,bIsSubClose:!0}},oUIConfig:{oSubDist:{nOrder:1,cTagName:"span"},oSubTotalDist:{nOrder:2,cTagName:"span"},oTotalDist:{nOrder:3,cTagName:"span"},oSubClose:{nOrder:4,cTagName:"a",cText:L.measure.TipMarker.createIcon.closeText,bIsClick:!0},oTotalClose:{nOrder:5,cTagName:"a",cClassName:"",cText:L.measure.TipMarker.createIcon.closeText}},initialize:function(t,e,i){L.Util.extend(this.oUIConfig,i.oUIConfig),L.Marker.prototype.initialize.call(this,t,i),this.bIsSubTotalDist=this.options.bIsSubTotalDist,this._oParent=e,this.aoTag=[]},_initIcon:function(){var t=this.options,e=this._map,i=e.options.zoomAnimation&&e.options.markerZoomAnimation,o=i?"leaflet-zoom-animated":"leaflet-zoom-hide",s=this.createIcon();L.DomUtil.addClass(s,o),t.keyboard&&(s.tabIndex="0"),this._icon=s,this._initInteraction(),t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),t.opacity<1&&this._updateOpacity();var n=this._map._panes;n.markerPane.appendChild(this._icon)},_setIconStyles:function(t,e){var i,o=this.options,s=L.point(o[e+"Size"]);i=L.point(o.iconAnchor),!i&&s&&(i=s.divideBy(2,!0)),t.className="leaflet-marker-"+e+" "+o.className,i&&(t.style.marginLeft=-i.x+"px",t.style.marginTop=-i.y+"px"),s&&(t.style.width=s.x+"px",t.style.height=s.y+"px")},createIcon:function(){var t=L.DomUtil.create("div","");this._setIconStyles(t,"icon"),this.oTagContanier=t;var e=this.options.oShowConfig;for(var i in e)if(e[i]){var o=i.replace("bIs","o");if(this.oUIConfig.hasOwnProperty(o)){var s=L.Measure.tipTag(this,this.oUIConfig[o]);s.setFlag(o),this.addTag(s),this.oUIConfig[o].bIsClick&&s.setClick(this.closeHanler,this)}}return t},addTag:function(t){var e=this.aoTag;if(e.length<=0)return e.push(t),void this.oTagContanier.appendChild(t.oTag);for(var i=e.length,o=0;o<e.length;o++)if(t.nOrder<e[o].nOrder){i=o;break}i===e.length?(this.oTagContanier.appendChild(t.oTag),this.aoTag.push(t)):(this.oTagContanier.insertBefore(t.oTag,this.aoTag[i].oTag),this.aoTag.splice(i,0,t))},addAllClose:function(){var t=this.getTagByFlag("oTotalClose");t||(t=L.Measure.tipTag(this,this.oUIConfig.oTotalClose),t.setFlag("oTotalClose"),this.addTag(t),t.setClick(function(){this._oParent.deleteDist()},this))},deleteTag:function(t){var e=this.aoTag;if(e&&!(e.length<=0))for(var i=0;i<e.length;i++)if(e[i].cFlag===t){this.oTagContanier.removeChild(e[i].oTag),e.splice(i,1);break}},deleteSubTotalTag:function(){this.deleteTag("oSubTotalDist")},addTotalPenal:function(t){var e=this.getTagByFlag("oTotalDist");e||(e=L.Measure.tipTag(this,this.oUIConfig.oTotalDist),e.setFlag("oTotalDist"),this.addTag(e)),this.setTotalDist(t,e)},setTotalDist:function(t,e){if(e||(e=this.getTagByFlag("oTotalDist")),e){this.deleteTag("oSubTotalDist");var i=L.measure.TipMarker.addTotalPenal.total,o=(t/1e3).toFixed(2)+L.measure.TipMarker.addTotalPenal.until;e.setText(i+o)}},setDist:function(t){this.dDist=t;var e=this.getTagByFlag("oSubDist");e&&e.setText(t)},getTagByFlag:function(t){var e=this.aoTag;if(!e||e.length<=0)return i;for(var o=0;o<e.length;o++)if(e[o].cFlag===t)return e[o];return i},setSubTotalDist:function(t){var e=this.getTagByFlag("oSubTotalDist");if(e){var i=L.measure.TipMarker.setSubTotalDistTag.total,o=(t/1e3).toFixed(2)+L.measure.TipMarker.setSubTotalDistTag.until;e.setText(i+o)}},closeHanler:function(){this._oParent.removeTipMarker(this)}}),L.Measure.tipMarker=function(t,e,i){return new L.Measure.TipMarker(t,e,i)},L.Measure.TipTag=L.Class.extend({options:{cTagName:"span",cClassName:"",nOrder:1,cText:""},initialize:function(t,e){L.setOptions(this,e),this._oParent=t,this.createTag()},createTag:function(){var t=L.DomUtil.create(this.options.cTagName,"");return this.nOrder=this.options.nOrder,this.options.cClassName&&L.DomUtil.addClass(t,this.options.cClassName),t.text=this.options.cText,this.oTag=t,t},setFlag:function(t){this.cFlag=t,this.oTag.setAttribute("cFlag",t)},setText:function(t){if("string"==typeof t)return void(this.oTag.innerText=t);var e=L.measure.TipMarker.setText.beginText;0!==t&&(e=(t/1e3).toFixed(2)+L.measure.TipMarker.setText.until),this.oTag.innerText=e},setClick:function(t,e){L.DomEvent.on(this.oTag,"click",t,e)}}),L.Measure.tipTag=function(t,e){return new L.Measure.TipTag(t,e)}}(window,document);